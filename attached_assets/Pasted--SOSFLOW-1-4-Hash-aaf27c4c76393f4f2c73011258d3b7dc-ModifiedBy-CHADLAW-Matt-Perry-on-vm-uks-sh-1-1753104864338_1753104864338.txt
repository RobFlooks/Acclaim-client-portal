# SOSFLOW 1.4
#Hash aaf27c4c76393f4f2c73011258d3b7dc
#ModifiedBy CHADLAW\Matt.Perry on vm-uks-sh-11
#LastSave 21/07/2025 14:32:37
SetVariables SetVariables1
	Initializations
		#For subsequent workflows (runscriptfile)
		FROMWORKFLOW=TRUE
		
		#Authentication
		organisation_id =3
		username = 'acclaim.orgadmin@acclaim.law'
		password ='Chadw1ck816!!'
		
		external_case_ref = 'Ref ' + ConnectApp.System.Firmsname + ":" + matter.entitytype + ":" + matter.entityref
		# URL encode spaces in external_case_ref
		external_case_ref_encoded=replace(external_case_ref," ","_")
		#external_case_ref_encoded = external_case_ref.replace(' ', '%20')
		url='https://cb46d52f-84a8-405f-910d-210c6969a262-00-3p04s4dzuvkyp.spock.replit.dev/api/external/payments'
		# Add balance calculation
		
		#caseExternalRef (Required): The external reference of the case to add payment to
		caseExternalRef=external_case_ref_encoded
		#amount (Required): Payment amount in decimal format (e.g., "250.00")
		amount=125.00
		#paymentDate (Required): ISO 8601 formatted date/time when payment was received
		paymentDate=format(now,"dd/MM/yyyy")
		#externalRef (Required): Unique payment identifier from payment
		externalRef='PAYCL-125.MDP'
		#paymentMethod (Optional): Payment method (e.g., "BANK_TRANSFER", "CHEQUE", "CARD", "CASH")
		paymentMethod='Direct Credit'
		#notes (Optional)
		notes='This is a test payment'
	CardPosX 0
	CardPosY 0
	GOTO HttpWebRequest1

HttpWebRequest HttpWebRequest1
	Initializations
		method='POST'
		postvariables='caseExternalRef,amount,paymentDate,externalRef,paymentMethod,notes'
		ContentType='application/x-www-form-urlencoded'
		IgnoreCertificateErrors=TRUE
	CardPosX 230
	CardPosY 10
	GOTO Message2

DoNothing DoNothing1
	CardPosX 310
	CardPosY 130
	GOTO Message2 WHEN html.contains("id")

Message Message2
	Message %[message]
	Centred True
	Location system_tray
	MessageType Information
	CardPosX 510
	CardPosY 70

Message Message3
	Message %[caseExternalRef]
	Centred False
	Location main_area
	MessageType Information
	CardPosX 10
	CardPosY 150

