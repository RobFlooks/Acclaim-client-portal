<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Azure Migration Guide - Acclaim Credit Management System</title>
        <style>
            @media print {
                body {
                    font-family:
                        -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                        sans-serif;
                    font-size: 11pt;
                    line-height: 1.4;
                    color: #000;
                    margin: 0;
                    padding: 0;
                }

                h1 {
                    color: #0078d4 !important;
                    font-size: 18pt;
                    border-bottom: 2pt solid #0078d4;
                    padding-bottom: 8pt;
                    page-break-after: avoid;
                    margin-top: 0;
                }

                h2 {
                    color: #106ebe !important;
                    font-size: 14pt;
                    margin-top: 20pt;
                    margin-bottom: 8pt;
                    page-break-after: avoid;
                }

                h3 {
                    color: #323130 !important;
                    font-size: 12pt;
                    margin-top: 16pt;
                    margin-bottom: 6pt;
                    page-break-after: avoid;
                }

                pre,
                code {
                    font-family: "Courier New", monospace;
                    font-size: 9pt;
                    background-color: #f8f8f8 !important;
                    border: 1pt solid #ddd;
                    padding: 6pt;
                    page-break-inside: avoid;
                    white-space: pre-wrap;
                    word-wrap: break-word;
                }

                pre {
                    margin: 8pt 0;
                    border-radius: 3pt;
                }

                ul,
                ol {
                    margin: 8pt 0;
                    padding-left: 16pt;
                }

                li {
                    margin-bottom: 3pt;
                    page-break-inside: avoid;
                }

                table {
                    border-collapse: collapse;
                    width: 100%;
                    margin: 12pt 0;
                    page-break-inside: avoid;
                }

                th,
                td {
                    border: 1pt solid #333;
                    padding: 6pt;
                    text-align: left;
                    font-size: 10pt;
                }

                th {
                    background-color: #f0f0f0 !important;
                    font-weight: bold;
                }

                .page-break {
                    page-break-before: always;
                }

                @page {
                    margin: 2cm;
                    size: A4;

                    @top-center {
                        content: "Azure Migration Guide - Acclaim Credit Management System";
                        font-size: 9pt;
                        color: #666;
                    }

                    @bottom-center {
                        content: "Page " counter(page) " of " counter(pages);
                        font-size: 9pt;
                        color: #666;
                    }
                }
            }

            @media screen {
                body {
                    font-family:
                        -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                        sans-serif;
                    max-width: 800px;
                    margin: 0 auto;
                    padding: 40px 20px;
                    line-height: 1.6;
                    color: #333;
                    background-color: #fff;
                }

                h1 {
                    color: #0078d4;
                    border-bottom: 3px solid #0078d4;
                    padding-bottom: 10px;
                }

                h2 {
                    color: #106ebe;
                    margin-top: 30px;
                }

                h3 {
                    color: #323130;
                }

                code {
                    background-color: #f6f8fa;
                    padding: 2px 4px;
                    border-radius: 3px;
                    font-family: "Monaco", "Menlo", monospace;
                }

                pre {
                    background-color: #f6f8fa;
                    border: 1px solid #e1e4e8;
                    border-radius: 6px;
                    padding: 16px;
                    overflow-x: auto;
                }

                pre code {
                    background-color: transparent;
                    padding: 0;
                }

                ul,
                ol {
                    padding-left: 20px;
                }

                li {
                    margin-bottom: 5px;
                }

                table {
                    border-collapse: collapse;
                    width: 100%;
                    margin: 20px 0;
                }

                th,
                td {
                    border: 1px solid #ddd;
                    padding: 8px 12px;
                    text-align: left;
                }

                th {
                    background-color: #f6f8fa;
                    font-weight: 600;
                }

                .print-instructions {
                    background-color: #e7f3ff;
                    border-left: 4px solid #0078d4;
                    padding: 15px;
                    margin: 20px 0;
                    border-radius: 4px;
                }
            }
        </style>
    </head>
    <body>
        <div class="print-instructions" style="display: block">
            <h3>ðŸ“„ How to Save as PDF:</h3>
            <ol>
                <li>
                    <strong>Press Ctrl+P</strong> (Cmd+P on Mac) to open the
                    print dialog
                </li>
                <li>
                    <strong>Select "Save as PDF"</strong> as the destination
                </li>
                <li>
                    <strong>Choose "More settings"</strong> and ensure:
                    <ul>
                        <li>Paper size: A4</li>
                        <li>Margins: Default</li>
                        <li>Options: âœ“ Background graphics</li>
                    </ul>
                </li>
                <li><strong>Click "Save"</strong> and choose your filename</li>
            </ol>
            <p>
                <em
                    >This guide is optimized for PDF printing with proper page
                    breaks and styling.</em
                >
            </p>
        </div>

        <h1>Azure Migration Guide for Acclaim Credit Management System</h1>
        <h2>Overview</h2>
        <p>
            This guide will help you migrate your Acclaim Credit Management
            System from Replit to Microsoft Azure. The system consists of a
            React frontend, Express.js backend, PostgreSQL database, and file
            upload functionality.
        </p>
        <h2>Prerequisites</h2>
        <ul>
            <li>Azure subscription</li>
            <li>Azure CLI installed locally</li>
            <li>Node.js 18+ installed locally</li>
            <li>Git repository for your code</li>
        </ul>
        <h2>Architecture on Azure</h2>
        <ul>
            <li><strong>Frontend</strong>: Azure Static Web Apps</li>
            <li><strong>Backend</strong>: Azure App Service</li>
            <li><strong>Database</strong>: Azure Database for PostgreSQL</li>
            <li><strong>File Storage</strong>: Azure Blob Storage</li>
            <li><strong>Email</strong>: SendGrid (already configured)</li>
        </ul>
        <h2>Step 1: Prepare Your Code Repository</h2>
        <h3>1.1 Create a Git Repository</h3>
        <pre><code class="language-bash"># If not already done, initialize git in your project
git init
git add .
git commit -m &quot;Initial commit&quot;

# Push to GitHub, GitLab, or Azure DevOps
git remote add origin &lt;your-repository-url&gt;
git push -u origin main
</code></pre>
        <h3>1.2 Update Configuration Files</h3>
        <p>Create a production configuration file:</p>
        <p><strong>azure-deploy.json</strong></p>
        <pre><code class="language-json">{
  &quot;version&quot;: 2,
  &quot;builds&quot;: [
    {
      &quot;src&quot;: &quot;client/package.json&quot;,
      &quot;use&quot;: &quot;@vercel/static-build&quot;,
      &quot;config&quot;: {
        &quot;distDir&quot;: &quot;dist&quot;
      }
    }
  ],
  &quot;routes&quot;: [
    {
      &quot;src&quot;: &quot;/api/(.*)&quot;,
      &quot;dest&quot;: &quot;/server/index.js&quot;
    },
    {
      &quot;src&quot;: &quot;/(.*)&quot;,
      &quot;dest&quot;: &quot;/client/dist/$1&quot;
    }
  ]
}
</code></pre>
        <p><strong>package.json</strong> (update scripts):</p>
        <pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;build&quot;: &quot;npm run build:client &amp;&amp; npm run build:server&quot;,
    &quot;build:client&quot;: &quot;cd client &amp;&amp; npm run build&quot;,
    &quot;build:server&quot;: &quot;cd server &amp;&amp; tsc&quot;,
    &quot;start&quot;: &quot;node server/dist/index.js&quot;,
    &quot;start:dev&quot;: &quot;npm run dev&quot;
  }
}
</code></pre>
        <h2>Step 2: Set Up Azure Database for PostgreSQL</h2>
        <h3>2.1 Create PostgreSQL Server</h3>
        <pre><code class="language-bash"># Login to Azure
az login

# Create resource group
az group create --name acclaim-rg --location &quot;UK South&quot;

# Create PostgreSQL server
az postgres server create \
  --resource-group acclaim-rg \
  --name acclaim-db-server \
  --location &quot;UK South&quot; \
  --admin-user acclaim_admin \
  --admin-password &lt;secure-password&gt; \
  --sku-name GP_Gen5_2 \
  --version 13
</code></pre>
        <h3>2.2 Configure Firewall Rules</h3>
        <pre><code class="language-bash"># Allow Azure services
az postgres server firewall-rule create \
  --resource-group acclaim-rg \
  --server acclaim-db-server \
  --name AllowAzureServices \
  --start-ip-address 0.0.0.0 \
  --end-ip-address 0.0.0.0

# Allow your IP (for setup)
az postgres server firewall-rule create \
  --resource-group acclaim-rg \
  --server acclaim-db-server \
  --name AllowMyIP \
  --start-ip-address &lt;your-ip&gt; \
  --end-ip-address &lt;your-ip&gt;
</code></pre>
        <h3>2.3 Create Database</h3>
        <pre><code class="language-bash"># Create the database
az postgres db create \
  --resource-group acclaim-rg \
  --server-name acclaim-db-server \
  --name acclaim_db
</code></pre>
        <h3>2.4 Migration Script</h3>
        <p>Create a migration script to transfer your data:</p>
        <p><strong>migrate-to-azure.sql</strong></p>
        <pre><code class="language-sql">-- Export from your current database and import to Azure
-- Use pg_dump to export your current database
-- Then import using psql to Azure PostgreSQL
</code></pre>
        <h2>Step 3: Set Up Azure App Service (Backend)</h2>
        <h3>3.1 Create App Service Plan</h3>
        <pre><code class="language-bash">az appservice plan create \
  --name acclaim-plan \
  --resource-group acclaim-rg \
  --location &quot;UK South&quot; \
  --sku B1 \
  --is-linux
</code></pre>
        <h3>3.2 Create Web App</h3>
        <pre><code class="language-bash">az webapp create \
  --resource-group acclaim-rg \
  --plan acclaim-plan \
  --name acclaim-api \
  --runtime &quot;NODE|18-lts&quot; \
  --deployment-local-git
</code></pre>
        <h3>3.3 Configure Environment Variables</h3>
        <pre><code class="language-bash"># Set environment variables
az webapp config appsettings set \
  --resource-group acclaim-rg \
  --name acclaim-api \
  --settings \
    NODE_ENV=production \
    DATABASE_URL=&quot;postgresql://acclaim_admin:&lt;password&gt;@acclaim-db-server.postgres.database.azure.com:5432/acclaim_db?sslmode=require&quot; \
    SESSION_SECRET=&quot;&lt;generate-secure-secret&gt;&quot; \
    SENDGRID_API_KEY=&quot;&lt;your-sendgrid-key&gt;&quot; \
    PORT=8000
</code></pre>
        <h2>Step 4: Set Up Azure Static Web Apps (Frontend)</h2>
        <h3>4.1 Create Static Web App</h3>
        <pre><code class="language-bash">az staticwebapp create \
  --name acclaim-frontend \
  --resource-group acclaim-rg \
  --source &lt;your-github-repo-url&gt; \
  --location &quot;West Europe&quot; \
  --branch main \
  --app-location &quot;client&quot; \
  --api-location &quot;server&quot; \
  --output-location &quot;dist&quot;
</code></pre>
        <h3>4.2 Configure Build Settings</h3>
        <p>
            Create <strong>.github/workflows/azure-static-web-apps.yml</strong>:
        </p>
        <pre><code class="language-yaml">name: Azure Static Web Apps CI/CD

on:
  push:
    branches:
      - main
  pull_request:
    types: [opened, synchronize, reopened, closed]
    branches:
      - main

jobs:
  build_and_deploy_job:
    if: github.event_name == &#39;push&#39; || (github.event_name == &#39;pull_request&#39; &amp;&amp; github.event.action != &#39;closed&#39;)
    runs-on: ubuntu-latest
    name: Build and Deploy Job
    steps:
      - uses: actions/checkout@v3
        with:
          submodules: true
      - name: Build And Deploy
        id: builddeploy
        uses: Azure/static-web-apps-deploy@v1
        with:
          azure_static_web_apps_api_token: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN }}
          repo_token: ${{ secrets.GITHUB_TOKEN }}
          action: &quot;upload&quot;
          app_location: &quot;client&quot;
          api_location: &quot;server&quot;
          output_location: &quot;dist&quot;
</code></pre>
        <h2>Step 5: Set Up Azure Blob Storage (File Uploads)</h2>
        <h3>5.1 Create Storage Account</h3>
        <pre><code class="language-bash">az storage account create \
  --name acclaimstorage \
  --resource-group acclaim-rg \
  --location &quot;UK South&quot; \
  --sku Standard_LRS
</code></pre>
        <h3>5.2 Create Container</h3>
        <pre><code class="language-bash">az storage container create \
  --name uploads \
  --account-name acclaimstorage \
  --public-access off
</code></pre>
        <h3>5.3 Update File Upload Code</h3>
        <p>
            You&#39;ll need to modify your file upload functionality to use
            Azure Blob Storage instead of local storage.
        </p>
        <p><strong>server/azure-storage.ts</strong></p>
        <pre><code class="language-typescript">import { BlobServiceClient } from &#39;@azure/storage-blob&#39;;

const connectionString = process.env.AZURE_STORAGE_CONNECTION_STRING;
const blobServiceClient = BlobServiceClient.fromConnectionString(connectionString);

export async function uploadToBlob(fileName: string, fileBuffer: Buffer) {
  const containerClient = blobServiceClient.getContainerClient(&#39;uploads&#39;);
  const blockBlobClient = containerClient.getBlockBlobClient(fileName);
  
  await blockBlobClient.upload(fileBuffer, fileBuffer.length);
  return blockBlobClient.url;
}
</code></pre>
        <h2>Step 6: Configure Domain and SSL</h2>
        <h3>6.1 Custom Domain (Optional)</h3>
        <pre><code class="language-bash"># Add custom domain to Static Web App
az staticwebapp hostname set \
  --name acclaim-frontend \
  --resource-group acclaim-rg \
  --hostname yourdomain.co.uk
</code></pre>
        <h3>6.2 SSL Certificate</h3>
        <p>Azure automatically provides SSL certificates for custom domains.</p>
        <h2>Step 7: Environment Variables Setup</h2>
        <h3>Frontend Environment Variables</h3>
        <p>Create <strong>client/.env.production</strong>:</p>
        <pre><code>VITE_API_URL=https://acclaim-api.azurewebsites.net
</code></pre>
        <h3>Backend Environment Variables</h3>
        <p>Set in Azure App Service:</p>
        <ul>
            <li><code>DATABASE_URL</code>: PostgreSQL connection string</li>
            <li><code>SESSION_SECRET</code>: Secure random string</li>
            <li><code>SENDGRID_API_KEY</code>: Your SendGrid API key</li>
            <li>
                <code>AZURE_STORAGE_CONNECTION_STRING</code>: Blob storage
                connection string
            </li>
            <li><code>NODE_ENV</code>: production</li>
        </ul>
        <h2>Step 8: Database Migration</h2>
        <h3>8.1 Export Current Database</h3>
        <pre><code class="language-bash"># On your current system
pg_dump $DATABASE_URL &gt; acclaim_backup.sql
</code></pre>
        <h3>8.2 Import to Azure PostgreSQL</h3>
        <pre><code class="language-bash"># Connect to Azure PostgreSQL and import
psql &quot;postgresql://acclaim_admin:&lt;password&gt;@acclaim-db-server.postgres.database.azure.com:5432/acclaim_db?sslmode=require&quot; &lt; acclaim_backup.sql
</code></pre>
        <h2>Step 9: Deploy and Test</h2>
        <h3>9.1 Deploy Backend</h3>
        <pre><code class="language-bash"># Add Azure as remote
git remote add azure &lt;deployment-url-from-app-service&gt;

# Deploy
git push azure main
</code></pre>
        <h3>9.2 Deploy Frontend</h3>
        <p>
            The frontend will automatically deploy via GitHub Actions when you
            push to main.
        </p>
        <h3>9.3 Test Application</h3>
        <ol>
            <li>Visit your Static Web App URL</li>
            <li>
                Test all functionality:
                <ul>
                    <li>User authentication</li>
                    <li>Case management</li>
                    <li>File uploads</li>
                    <li>Email notifications</li>
                    <li>Admin panel</li>
                </ul>
            </li>
        </ol>
        <h2>Step 10: Monitoring and Maintenance</h2>
        <h3>10.1 Set Up Application Insights</h3>
        <pre><code class="language-bash">az monitor app-insights component create \
  --app acclaim-insights \
  --location &quot;UK South&quot; \
  --resource-group acclaim-rg
</code></pre>
        <h3>10.2 Configure Backup</h3>
        <pre><code class="language-bash"># Enable automated backups for PostgreSQL
az postgres server configuration set \
  --name log_statement \
  --resource-group acclaim-rg \
  --server acclaim-db-server \
  --value all
</code></pre>
        <h2>Cost Considerations</h2>
        <h3>Estimated Monthly Costs (UK South):</h3>
        <ul>
            <li><strong>App Service B1</strong>: ~Â£40/month</li>
            <li><strong>PostgreSQL GP_Gen5_2</strong>: ~Â£120/month</li>
            <li><strong>Storage Account</strong>: ~Â£5/month</li>
            <li><strong>Static Web Apps</strong>: Free tier available</li>
            <li><strong>Application Insights</strong>: ~Â£10/month</li>
        </ul>
        <p><strong>Total</strong>: ~Â£175/month</p>
        <h3>Cost Optimization:</h3>
        <ul>
            <li>
                Use Azure Reserved Instances for 1-3 year commitments (30-60%
                savings)
            </li>
            <li>
                Consider Azure SQL Database instead of PostgreSQL for better
                integration
            </li>
            <li>Use Azure DevTest pricing if applicable</li>
        </ul>
        <h2>Security Checklist</h2>
        <ul>
            <li>
                <input disabled="" type="checkbox" /> Enable Azure AD
                authentication
            </li>
            <li>
                <input disabled="" type="checkbox" /> Configure network security
                groups
            </li>
            <li>
                <input disabled="" type="checkbox" /> Enable Azure Security
                Center
            </li>
            <li>
                <input disabled="" type="checkbox" /> Set up Azure Key Vault for
                secrets
            </li>
            <li>
                <input disabled="" type="checkbox" /> Configure backup and
                disaster recovery
            </li>
            <li>
                <input disabled="" type="checkbox" /> Enable monitoring and
                alerting
            </li>
            <li>
                <input disabled="" type="checkbox" /> Review and configure CORS
                settings
            </li>
            <li>
                <input disabled="" type="checkbox" /> Enable Azure DDoS
                protection
            </li>
        </ul>
        <h2>Troubleshooting</h2>
        <h3>Common Issues:</h3>
        <ol>
            <li>
                <strong>Database Connection</strong>: Check firewall rules and
                connection string
            </li>
            <li>
                <strong>File Uploads</strong>: Verify Azure Storage
                configuration
            </li>
            <li>
                <strong>Environment Variables</strong>: Ensure all required
                variables are set
            </li>
            <li><strong>CORS Issues</strong>: Configure CORS in App Service</li>
            <li>
                <strong>Build Failures</strong>: Check Node.js version
                compatibility
            </li>
        </ol>
        <h3>Support Resources:</h3>
        <ul>
            <li>
                Azure Documentation:
                <a href="https://docs.microsoft.com/azure"
                    >https://docs.microsoft.com/azure</a
                >
            </li>
            <li>Azure Support: Create support ticket in Azure Portal</li>
            <li>Community Forums: Microsoft Q&amp;A</li>
        </ul>
        <p>
            This migration will provide you with a production-ready, scalable
            infrastructure on Microsoft Azure with proper monitoring, security,
            and backup capabilities.
        </p>
    </body>
</html>
